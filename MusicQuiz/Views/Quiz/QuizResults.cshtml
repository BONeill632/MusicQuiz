@model MusicQuiz.Web.Models.Quiz.QuizResultsViewModel
@{
    ViewData["Title"] = "Quiz Results";
    var score = ViewBag.Score as decimal? ?? 0;
    var totalQuestions = ViewBag.TotalQuestions as int? ?? 0;
    var correctAnswers = ViewBag.CorrectAnswers as int? ?? 0;
    var dateOfSubmission = ViewBag.DateOfSubmission as string;

    //Green answers
    var rightFirstTime = ViewBag.RightFirstTime as int? ?? 0;

    //Amber answers
    var rightSecondTime = ViewBag.RightSecondTime as int? ?? 0;
    var rightThirdtTime = ViewBag.RightThirdTime as int? ?? 0;
    var rightFourthTime = ViewBag.RightFourthTime as int? ?? 0;

    //Red answers
    var incorrectAnswers = ViewBag.IncorrectAnswers as int? ?? 0;
}
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        //Total 'right' answers, regardless of attempts
        var correctAnswers = @correctAnswers;

        //Total questions in quiz
        var totalQuestions = @totalQuestions;

        //Answers right first time
        var rightFirstTime = @rightFirstTime;

        //Answers that are right on any attempt more than one
        var rightSecondTime = @rightSecondTime;
        var rightThirdTime = @rightThirdtTime;
        var rightFourthTime = @rightFourthTime;

        //Answers that are just wrong.
        var incorrectAnswers = @incorrectAnswers;
    </script>
    <script src="~/js/quizResults.js"></script>
}

<h1>Quiz Results</h1>

<h3 class="centered">Your Score on</h3>
<div class="date-container centered">
    <span class="date ">@dateOfSubmission</span>
</div>
<div class="score-container">
    <span class="score">@score%</span>
</div>

<!-- Chart Wrapper with Responsive Sizing -->
<div class="chart-wrapper">
    <div id="chartContainer">
        <canvas id="scoreChart"></canvas>
    </div>
</div>


<h3 class="centered">Question Details</h3>

<div class="table-responsive">
    <table class="table table-modern">
        <thead>
            <tr>
                <th>Question</th>
                <th>Correct Answer</th>
                <th>Your Answer</th>
                <th>Result</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Questions != null)
            {
                @foreach (var question in Model.Questions)
                {
                    string rowClass = "";

                    if (question.UserAnswer == question.CorrectAnswer && question.AttemptNumber == 1)
                    {
                        rowClass = "row-success";
                    }
                    else if (question.UserAnswer == question.CorrectAnswer && question.AttemptNumber > 1)
                    {
                        rowClass = "row-warning";
                    }
                    else
                    {
                        rowClass = "row-danger";
                    }

                    <tr class="@rowClass">
                        <td>@question.Question</td>
                        <td>@question.CorrectAnswer</td>
                        <td>@question.UserAnswer</td>
                        @if (question.UserAnswer == question.CorrectAnswer && question.AttemptNumber == 1)
                        {
                            <td>Correct</td>
                        }
                        else if (question.UserAnswer == question.CorrectAnswer && question.AttemptNumber > 1)
                        {
                            <td>Correct, attempt @question.AttemptNumber</td>
                        }
                        else
                        {
                            <td>Incorrect</td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<div class="row my-5 text-center">
    <div class="col">
        <a class="btn btn-danger btn-lg" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
    </div>
</div>

