@model MusicQuiz.Web.Models.Quiz.QuizResultsViewModel
@{
    ViewData["Title"] = "Quiz Results";
    var score = ViewBag.Score as decimal? ?? 0;
    var totalQuestions = ViewBag.TotalQuestions as int? ?? 0;
    var correctAnswers = ViewBag.CorrectAnswers as int? ?? 0;
    var dateOfSubmission = ViewBag.DateOfSubmission as string;

    //Green answers
    var rightFirstTime = ViewBag.RightFirstTime as int? ?? 0;

    //Amber answers
    var rightSecondTime = ViewBag.RightSecondTime as int? ?? 0;
    var rightThirdtTime = ViewBag.RightThirdTime as int? ?? 0;
    var rightFourthTime = ViewBag.RightFourthTime as int? ?? 0;

    //Red answers
    var incorrectAnswers = ViewBag.IncorrectAnswers as int? ?? 0;

}
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        //Total 'right' answers, regardless of attempts
        var correctAnswers = @correctAnswers;

        //Total quesitions in quiz
        var totalQuestions = @totalQuestions;

        //Answers right first time
        var rightFirstTime = @rightFirstTime;

        //Answers that are right on any attempt more than one
        var rightSecondTime = @rightSecondTime;
        var rightThirdTime = @rightThirdtTime;
        var rightFourthTime = @rightFourthTime;

        //Answers that are just wrong.
        var incorrectAnswers = @incorrectAnswers;
    </script>
    <script src="~/js/quizResults.js"></script>
}

<h1>Quiz Results</h1>

<h3 class="centered">Your Score on</h3>
<div class="date-container centered">
    <span class="date ">@dateOfSubmission</span>
</div>
<div class="score-container">
    <span class="score">@score%</span>
</div>

<div class="chart-wrapper">
    <div id="chartContainer">
        <canvas id="scoreChart"></canvas>
    </div>
</div>

<h3 class="centered">Question Details</h3>
<table class="table table-modern">
    <thead>
        <tr>
            <th>Question</th>
            <th>Correct Answer</th>
            <th>Your First Answer</th>
            <th>Your Last Answer</th>
            <th>Result</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Questions != null)
        {
            @foreach (var question in Model.Questions)
            {
                string rowClass = "";

                if (question.FirstAnswer == question.CorrectAnswer)
                {
                    rowClass = "row-success"; // Light green for correct first answer
                }
                else if (question.UserAnswer == question.CorrectAnswer && question.AttemptNumber > 1)
                {
                    rowClass = "row-warning"; // Light orange for correct on a later attempt
                }
                else
                {
                    rowClass = "row-danger"; // Light red for incorrect
                }

                <tr class="@rowClass">
                    <td>@question.Question</td>
                    <td>@question.CorrectAnswer</td>
                    <td>@question.FirstAnswer</td>
                    <td>@question.UserAnswer</td>
                    @if (question.FirstAnswer == question.CorrectAnswer)
                    {
                        <td>
                            Correct
                        </td>
                    }
                    else if (question.UserAnswer == question.CorrectAnswer & question.AttemptNumber > 1)
                    {
                        <td>
                            Correct on attempt @question.AttemptNumber
                        </td>
                    }
                    else
                    {
                        <td>
                            Incorrect
                        </td>
                    }
                </tr>
            }
        }
    </tbody>
</table>